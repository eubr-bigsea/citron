---
language: node_js
node_js:
  - "4"

sudo: false

cache:
  directories:
    - node_modules

before_install:
  - npm config set spin false
  - npm install -g bower
  - bower --version
  - npm install phantomjs-prebuilt
  - phantomjs --version

install:
  - npm install
  - bower install

script:
  - npm test

before_deploy:
  - |

       declare -r SSH_FILE="$(mktemp -u $HOME/.ssh/id_rsa)"

       openssl aes-256-cbc \
         -K $encrypted_3f0d43c1617b_key \
         -iv $encrypted_3f0d43c1617b_iv \
         -in ".travis/github_deploy_key.enc" \
         -out "$SSH_FILE" -d
       chmod 600 $SSH_FILE
       ssh-add $SSH_FILE

deploy:
  provider: script
  script: ember deploy $DEPLOY_ENV
  skip_cleanup: true
  branches:
    only:
      - gm_deploy
#  on:
#    tags: true
